# 関数

皆さんはJava8を触ったことがあると思うので、ラムダ式は聞いたことがあると思います。Java8では初めて関数が第1級オブジェクトとして扱われるようになりました。それがどういうことかというと、関数を変数に代入したり、関数の引数に関数を渡したり、関数の戻り値として関数を返すことができる高階関数を扱えるようになりました。これはとても素晴らしいことです。関数型プログラミングを学ぶことで自然と状態管理をする必要がない実装ができるようになります。

#### 関数宣言

関数宣言は `function文` を使って宣言します。

```js
function add(a, b) {
  return a + b;
}

var output = add(1, 2);
console.log(output); //=> 3
```

以下のようにトップレベルまたは関数ブロックの中以外での関数宣言をしてはいけません。環境によってはエラーになる恐れがあります。詳しく知りたい場合はstrictモードについて調べると良いですよ。

```js
// ifブロックの中で関数定義
if(true){
  function foo(){
    return 'foo';
  }
  foo();
}

// forブロックの中で関数定義
for(var i = 0, i < 10, i++){
  function foo(){
    return 'foo';
  }
}

// こういうのはOK
function foo(){
  function bar(){}
};
```

#### 関数リテラル

関数を変数に代入することができます。この場合 `function name()` の形式でなくてよく`function()`の形式（匿名関数とか無名関数と呼ばれます）で記述します。こちらは関数宣言と違い`if`ブロックの中などで定義しても構いません。

```js
var add = function(a, b) {
  return a + b;
}

var output = add(1, 2);
console.log(output); //=> 3
```

またES2015ではアロー関数式（いわゆるラムダ式）が導入されました。これにより以下のように書くこともできます。（ただし`this`の扱いが関数リテラルとは異なるので全く同じではありません）

```js
const add = (a, b) => {
  return a + b
}

const foo = a => a + 1 // 1ステートメントのみならばreturnと{}が不要。引数が一つならば()は不要。

const bar = () => ({ bar: 'bar'}) // 返り値がオブジェクトの場合は()で囲む必要がある。
```

#### 即時関数

以下のように関数宣言を式として評価することで宣言と同時に実行するということが可能です。よくあるのが以下の二つです。レガシー環境のJavaScriptでは必ず見ることになると思います。

```js
// ()で囲むパターン。ファイルのトップレベルで使用する場合は;を先頭に置く。
;(function(){
  console.log('hello');
})();

// !で評価するパターン（即時関数の戻り値を受け取る場合はこのパターンは使わない）
!function(){
  console.log('world');
}();
```



